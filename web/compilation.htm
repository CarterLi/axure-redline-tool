<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
<div class="redline-tool-wrapper redline-layer">
    <div class="hover-layer" id="t-hover"></div>
    <div class="hover-layer" id="r-hover"></div>
    <div class="hover-layer" id="b-hover"></div>
    <div class="hover-layer" id="l-hover"></div>
    <div class="hover-o-layer" id="to-hover"></div>
    <div class="hover-o-layer" id="ro-hover"></div>
    <div class="hover-o-layer" id="bo-hover"></div>
    <div class="hover-o-layer" id="lo-hover"></div>
    <div class="select-layer" id="t-select"></div>
    <div class="select-layer" id="r-select"></div>
    <div class="select-layer" id="b-select"></div>
    <div class="select-layer" id="l-select"></div>
    <div class="dimension-layer" id="t-dimension"><span></span></div>
    <div class="dimension-layer" id="r-dimension"><span></span></div>
    <div class="dimension-layer" id="b-dimension"><span></span></div>
    <div class="dimension-layer" id="l-dimension"><span></span></div>
    <div class="measure-layer" id="t-measure"></div>
    <div class="measure-layer" id="r-measure"></div>
    <div class="measure-layer" id="b-measure"></div>
    <div class="measure-layer" id="l-measure"></div>
    <div id="redline-panel">
        <div id="redline-panel-menu">
            <div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
        <div class="redline-tool-enabler">
            <div>Redline Tool Enable:</div>
            <div class="switch">
                <input id="toggle-enable" class="toggle-switch" type="checkbox">
                <label for="toggle-enable"></label>
            </div>
        </div>
    </div>
</div>
<style type="text/css">
.redline-layer {
    font-family: 'Lato', sans-serif;
}

#redline-panel {
    font-size: 12px;
    position: fixed;
    z-index: 99999;
    top: 0;
    left: calc(100% - 5px);
    overflow-x: visible;
    width: 250px;
    height: calc(100% - 40px);
    padding: 20px;
    transition: all 0.1s ease-in-out;
    color: #FFFFFF;
    background-color: rgba(51, 51, 51, 0.9);
}

#redline-panel p {
    margin: 10px 0 0 0;
}

#redline-panel input,
#redline-panel textarea {
    font-size: 12px;
    width: calc(100% - 12px);
    margin-top: 0;
    padding: 4px 5px;
    cursor: text;
    opacity: 0.5;
    border: solid 1px #FFFFFF;
    border-radius: 3px;
}

#redline-panel textarea {
    height: 50px;
    resize: none;
}

.redline-panel-exposed {
    transform: translateX(-285px);
}

#redline-panel-menu {
    position: absolute;
    top: 20px;
    left: 0;
    display: flex;
    width: 20px;
    height: 40px;
    cursor: pointer;
    transform: translateX(-20px);
    border-top-left-radius: 20px;
    border-bottom-left-radius: 20px;
    background-color: inherit;
    justify-content: center;
    align-items: center;
}

#redline-panel-menu > div > div {
    width: 12px;
    height: 2px;
    margin: 3px 0 3px 5px;
    background-color: #FFFFFF;
}

.redline-tool-enabler {
    font-size: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.switch .toggle-switch {
    position: absolute;
    visibility: hidden;
    margin-left: -9999px;
}

.switch .toggle-switch + label {
    position: relative;
    display: block;
    width: 60px;
    height: 28px;
    padding: 2px;
    cursor: pointer;
    user-select: none;
    transition: all 0.15s ease-in-out;
    border-radius: 28px;
    outline: none;
    background-color: #DDDDDD;
}

.switch .toggle-switch + label:before,
.switch .toggle-switch + label:after {
    position: absolute;
    display: block;
    content: '';
    transition: all 0.15s ease-in-out;
}

.switch .toggle-switch + label:before {
    top: 2px;
    right: 2px;
    bottom: 2px;
    left: 2px;
    border-radius: 28px;
    background-color: #FFFFFF;
}

.switch .toggle-switch + label:after {
    top: 4px;
    bottom: 4px;
    left: 4px;
    width: 24px;
    border-radius: 50%;
    background-color: #DDDDDD;
}

.switch .toggle-switch:checked + label {
    background-color: #4EDEC2;
}

.switch .toggle-switch:checked + label:after {
    margin-left: 32px;
    background-color: #4EDEC2;
}

.redline-panel-section {
    margin-top: 20px;
}

.hover-layer,
.hover-o-layer,
.select-layer,
.dimension-layer,
.measure-layer {
    position: absolute;
    display: none;
    width: 0;
    height: 0;
}

.hover-layer {
    z-index: 9997;
    border: solid 1px #4860FF;
    border-right: none;
    border-bottom: none;
}

.hover-o-layer {
    z-index: 9996;
    border: dashed 1px #4860FF;
    border-right: none;
    border-bottom: none;
}

.select-layer {
    z-index: 9998;
    border: solid 1px #E89A28;
    border-right: none;
    border-bottom: none;
}

.dimension-layer {
    font-size: 10px;
    font-weight: bold;
    z-index: 9999;
    display: flex;
    min-width: 30px;
    min-height: 20px;
    padding: 0;
    letter-spacing: 1px;
    color: #FFFFFF;
    border-radius: 5px;
    background-color: #E89A28;
    justify-content: center;
    align-items: center;
}

.measure-layer {
    z-index: 9995;
    border: solid 1px #E89A28;
    border-right: none;
    border-bottom: none;
}
</style>
<script type="text/javascript">
var enableTool = true,
    borderThickness = 1,
    labelSpacing = 5,
    hoveredElement = '',
    selectedElement = '',
    elemMeas = {
        width: 0,
        height: 0,
        offsetTop: 0,
        offsetLeft: 0
    },
    elemSelectMeas = {
        width: 0,
        height: 0,
        offsetTop: 0,
        offsetLeft: 0
    },
    intraElemMeas = {
        top: 0,
        right: 0,
        bottom: 0,
        left: 0
    },
    redlineClass,
    dimensionMarkerWidth = 0,
    dimensionMarkerHeight = 0;

var cssProperties = {
    'properties': {
        'width': '',
        'height': ''
    },
    'styles': {
        'background-color': '',
        'opacity': '',
        'border-top-width': '',
        'border-top-style': '',
        'border-top-color': '',
        'border-top-left-radius': '',
        'box-shadow': ''
    },
    'text': {
        'font-family': '',
        'font-size': '',
        'font-weight': '',
        'line-height': '',
        'text-align': '',
        'color': '',
        '_content': ''
    }
};

$(document).ready(function() {

    initTool();

    //*****Enable/Disable Redline Tool*****
    $('#redline-panel').on('change', '.switch', function() {
        enableRedline();
    });

    //*****Element Hover*****
    $('body').on('mouseenter', '*', function() {
        elementHover($(this));
    });

    //*****Element Leave*****
    $('body').on('mouseleave', '*', function() {
        clearRedline();
    });

    //*****Element Click*****
    $('body').on('click', '*', function() {
        elementClick($(this));
    });

    //*****Open/Close Redline Panel*****
    $('#redline-panel').on('click', '#redline-panel-menu', function() {
        $('#redline-panel').toggleClass('redline-panel-exposed');
    });

    //*****Handle Element Clickaway*****
    $('body').on('click', function(e) {
        if (e.target === this) {
            closeRedline();
        }
    });

    //*****Autoselect Redline Panel Content****
    $('#redline-panel').on('mouseup', 'input', function() {
        $(this).select();
    });

    //*****Autoselect Redline Panel Content****
    $('#redline-panel').on('mouseup', 'textarea', function() {
        $(this).select();
    })
});

//*************************************************************************************************
//*                                 Initialize our tool.                                          *
//*************************************************************************************************
function initTool() {
    $('.redline-tool-wrapper *').addClass('redline-layer'); //Label all redline tool elelemnts.
    $('.redline-layer').hide();
    $('.redline-tool-wrapper').show();
    $('#redline-panel').show();
    $('#redline-panel *').show();
    $('.toggle-switch').prop('checked', true);
    enableRedline();
}

//*************************************************************************************************
//*                             Enable or disable our tool.                                       *
//*************************************************************************************************
function enableRedline() {
    enableTool = $('.toggle-switch').prop('checked');

    if (!enableTool) {
        setTimeout(function() {
            closeRedline();
        }, 250);
    }
}

//*************************************************************************************************
//*                             Handle element hover actions.                                     *
//*************************************************************************************************
function elementHover(element) {
    if (enableTool) {
        hoveredElement = element;
        if (!isRedlineElement(hoveredElement)) {
            highlightHoverElement();
            //*****Check if we're hovering over our previously-selected element.*****
            if (hoveredElement[0] == selectedElement[0]) {
                highlightSelectElement();
            } else if (selectedElement != '') {
                measureIntraElementDistance();
                drawIntraElementMarkers();
            }
        }
    }
}

//*************************************************************************************************
//*                             Handle element click actions.                                     *
//*************************************************************************************************
function elementClick(element) {
    if (enableTool) {
        if (!isRedlineElement(element)) {
            selectedElement = findDeepestChild(element);
            clearRedline();
            highlightSelectElement();
            updateRedlinePanel(selectedElement);
        }
    }
}

//*************************************************************************************************
//*              Ensure we aren't interacting with a redline-specific element.                    *
//*************************************************************************************************
function isRedlineElement(element) {
    var redlineStatus;

    redlineStatus = element.attr('class') === undefined ? '' : element.attr('class');
    if (redlineStatus.indexOf('redline-layer') == '-1') {
        return false;
    } else {
        return true;
    }
}

//*************************************************************************************************
//*                  Highlight our hovered element and add extension lines.                       *
//*************************************************************************************************
function highlightHoverElement() {
    elemMeas.width = hoveredElement.outerWidth();
    elemMeas.height = hoveredElement.outerHeight();
    elemMeas.offsetTop = hoveredElement.offset().top;
    elemMeas.offsetLeft = hoveredElement.offset().left;
    $('.hover-layer').show();
    $('.hover-o-layer').show();
    $('#t-hover').width(elemMeas.width + borderThickness);
    $('#b-hover').width(elemMeas.width);
    $('#r-hover').height(elemMeas.height);
    $('#l-hover').height(elemMeas.height);

    $('#t-hover').offset({
        top: elemMeas.offsetTop - borderThickness,
        left: elemMeas.offsetLeft - borderThickness
    });
    $('#b-hover').offset({
        top: elemMeas.offsetTop + elemMeas.height,
        left: elemMeas.offsetLeft - borderThickness
    });
    $('#r-hover').offset({
        top: elemMeas.offsetTop,
        left: elemMeas.offsetLeft + elemMeas.width
    });
    $('#l-hover').offset({
        top: elemMeas.offsetTop,
        left: elemMeas.offsetLeft - borderThickness
    });

    $('#to-hover').width($(window).innerWidth() - (borderThickness * 2));
    $('#bo-hover').width($(window).innerWidth() - (borderThickness * 2));
    $('#ro-hover').height($(window).innerHeight() - (borderThickness * 2));
    $('#lo-hover').height($(window).innerHeight() - (borderThickness * 2));

    $('#to-hover').offset({
        top: elemMeas.offsetTop - borderThickness,
        left: 0
    });
    $('#bo-hover').offset({
        top: elemMeas.offsetTop + elemMeas.height,
        left: 0
    });
    $('#ro-hover').offset({
        top: 0,
        left: elemMeas.offsetLeft + elemMeas.width
    });
    $('#lo-hover').offset({
        top: 0,
        left: elemMeas.offsetLeft - borderThickness
    });
}

//*************************************************************************************************
//*                  Highlight our selected element and add extension lines.                      *
//*************************************************************************************************
function highlightSelectElement() {
    elemSelectMeas.width = selectedElement.outerWidth();
    elemSelectMeas.height = selectedElement.outerHeight();
    elemSelectMeas.offsetTop = selectedElement.offset().top;
    elemSelectMeas.offsetLeft = selectedElement.offset().left;
    $('.select-layer').show();
    $('#t-select').width(elemSelectMeas.width + borderThickness);
    $('#b-select').width(elemSelectMeas.width);
    $('#r-select').height(elemSelectMeas.height);
    $('#l-select').height(elemSelectMeas.height);

    $('#t-select').offset({
        top: elemSelectMeas.offsetTop - borderThickness,
        left: elemSelectMeas.offsetLeft - borderThickness
    });
    $('#b-select').offset({
        top: elemSelectMeas.offsetTop + elemSelectMeas.height,
        left: elemSelectMeas.offsetLeft - borderThickness
    });
    $('#r-select').offset({
        top: elemSelectMeas.offsetTop,
        left: elemSelectMeas.offsetLeft + elemSelectMeas.width
    });
    $('#l-select').offset({
        top: elemSelectMeas.offsetTop,
        left: elemSelectMeas.offsetLeft - borderThickness
    });

    $('#t-dimension').show();
    $('#r-dimension').show();
    $('#t-dimension > span').show();
    $('#r-dimension > span').show();
    dimensionMarkerWidth = $('.dimension-layer').width();
    dimensionMarkerHeight = $('.dimension-layer').height();
    $('#t-dimension > span').text(Math.round(elemSelectMeas.width));
    $('#r-dimension > span').text(Math.round(elemSelectMeas.height));
    $('#t-dimension').offset({
        top: elemSelectMeas.offsetTop - dimensionMarkerHeight - labelSpacing,
        left: elemSelectMeas.offsetLeft + (elemSelectMeas.width / 2) - (dimensionMarkerWidth / 2)
    });
    $('#r-dimension').offset({
        top: elemSelectMeas.offsetTop + (elemSelectMeas.height / 2) - (dimensionMarkerHeight / 2),
        left: elemSelectMeas.offsetLeft + elemSelectMeas.width + labelSpacing
    });
}

//*************************************************************************************************
//*             Measure distance between selected element to newly hovered element.               *
//*************************************************************************************************
function measureIntraElementDistance() {
    $.each(intraElemMeas, function(i, value) {
        intraElemMeas[i] = 0;
    });

    if (elemMeas.offsetTop > elemSelectMeas.offsetTop + elemSelectMeas.height) {
        intraElemMeas.bottom = Math.abs(elemSelectMeas.offsetTop + elemSelectMeas.height - elemMeas.offsetTop);
    } else if (elemSelectMeas.offsetTop > elemMeas.offsetTop + elemMeas.height) {
        intraElemMeas.top = Math.abs(elemMeas.offsetTop + elemMeas.height - elemSelectMeas.offsetTop);
    } else if (elemSelectMeas.offsetTop > elemMeas.offsetTop && elemSelectMeas.offsetTop + elemSelectMeas.height > elemMeas.offsetTop + elemMeas.height) {
        intraElemMeas.top = Math.abs(elemMeas.offsetTop - elemSelectMeas.offsetTop);
    } else if (elemSelectMeas.offsetTop < elemMeas.offsetTop && elemSelectMeas.offsetTop + elemSelectMeas.height < elemMeas.offsetTop + elemMeas.height) {
        intraElemMeas.bottom = Math.abs((elemMeas.offsetTop + elemMeas.height) - (elemSelectMeas.offsetTop + elemSelectMeas.height));
    } else {
        intraElemMeas.top = elemSelectMeas.offsetTop - elemMeas.offsetTop;
        intraElemMeas.bottom = (elemMeas.offsetTop + elemMeas.height) - (elemSelectMeas.offsetTop + elemSelectMeas.height);
    }

    if (elemSelectMeas.offsetLeft > elemMeas.offsetLeft + elemMeas.width) {
        intraElemMeas.left = Math.abs(elemMeas.offsetLeft + elemMeas.width - elemSelectMeas.offsetLeft);
    } else if (elemMeas.offsetLeft > elemSelectMeas.offsetLeft + elemSelectMeas.width) {
        intraElemMeas.right = Math.abs(elemSelectMeas.offsetLeft + elemSelectMeas.width - elemMeas.offsetLeft);
    } else if (elemSelectMeas.offsetLeft > elemMeas.offsetLeft && elemSelectMeas.offsetLeft + elemSelectMeas.width > elemMeas.offsetLeft + elemMeas.width) {
        intraElemMeas.left = Math.abs(elemMeas.offsetLeft - elemSelectMeas.offsetLeft);
    } else if (elemSelectMeas.offsetLeft < elemMeas.offsetLeft && elemSelectMeas.offsetLeft + elemSelectMeas.width < elemMeas.offsetLeft + elemMeas.width) {
        intraElemMeas.right = Math.abs((elemMeas.offsetLeft + elemMeas.width) - (elemSelectMeas.offsetLeft + elemSelectMeas.width));
    } else {
        intraElemMeas.left = elemSelectMeas.offsetLeft - elemMeas.offsetLeft;
        intraElemMeas.right = (elemMeas.offsetLeft + elemMeas.width) - (elemSelectMeas.offsetLeft + elemSelectMeas.width);
    }
}

//*************************************************************************************************
//*                   Append our intra-element dimension lines and labels.                        *
//*************************************************************************************************
function drawIntraElementMarkers() {
    dimensionMarkerWidth = $('.dimension-layer').width();
    dimensionMarkerHeight = $('.dimension-layer').height();

    if (intraElemMeas.top != 0) {
        $('#t-measure').show();
        $('#t-measure').height(Math.abs(intraElemMeas.top) - borderThickness);
        if (intraElemMeas.top > 0) {
            $('#t-measure').offset({
                top: elemSelectMeas.offsetTop - intraElemMeas.top,
                left: elemSelectMeas.offsetLeft + (elemSelectMeas.width / 2)
            });
        } else {
            $('#t-measure').offset({
                top: elemSelectMeas.offsetTop,
                left: elemSelectMeas.offsetLeft + (elemSelectMeas.width / 2)
            });
        }
        $('#t-dimension').show();
        $('#t-dimension > span').show();
        $('#t-dimension > span').text(Math.round(Math.abs(intraElemMeas.top)));
        $('#t-dimension').offset({
            top: elemSelectMeas.offsetTop - (intraElemMeas.top / 2) - (dimensionMarkerHeight / 2),
            left: elemSelectMeas.offsetLeft + (elemSelectMeas.width / 2) + labelSpacing
        });
    }
    if (intraElemMeas.right != 0) {
        $('#r-measure').show();
        $('#r-measure').width(Math.abs(intraElemMeas.right) - borderThickness);
        if (intraElemMeas.right > 0) {
            $('#r-measure').offset({
                top: elemSelectMeas.offsetTop + (elemSelectMeas.height / 2),
                left: elemSelectMeas.offsetLeft + elemSelectMeas.width
            });
        } else {
            $('#r-measure').offset({
                top: elemSelectMeas.offsetTop + (elemSelectMeas.height / 2),
                left: elemSelectMeas.offsetLeft + elemSelectMeas.width + intraElemMeas.right
            });
        }

        $('#r-dimension').show();
        $('#r-dimension > span').show();
        $('#r-dimension > span').text(Math.round(Math.abs(intraElemMeas.right)));
        $('#r-dimension').offset({
            top: elemSelectMeas.offsetTop + (elemSelectMeas.height / 2) - dimensionMarkerHeight - labelSpacing,
            left: elemSelectMeas.offsetLeft + elemSelectMeas.width + (intraElemMeas.right / 2) - (dimensionMarkerWidth / 2)
        });
    }
    if (intraElemMeas.bottom != 0) {
        $('#b-measure').show();
        $('#b-measure').height(Math.abs(intraElemMeas.bottom) - borderThickness);
        if (intraElemMeas.bottom > 0) {
            $('#b-measure').offset({
                top: elemSelectMeas.offsetTop + elemSelectMeas.height,
                left: elemSelectMeas.offsetLeft + (elemSelectMeas.width / 2)
            });
        } else {
            $('#b-measure').offset({
                top: elemSelectMeas.offsetTop + elemSelectMeas.height + intraElemMeas.bottom,
                left: elemSelectMeas.offsetLeft + (elemSelectMeas.width / 2)
            });
        }

        $('#b-dimension').show();
        $('#b-dimension > span').show();
        $('#b-dimension > span').text(Math.round(Math.abs(intraElemMeas.bottom)));
        $('#b-dimension').offset({
            top: elemSelectMeas.offsetTop + elemSelectMeas.height + (intraElemMeas.bottom / 2) - (dimensionMarkerHeight / 2),
            left: elemSelectMeas.offsetLeft + (elemSelectMeas.width / 2) + labelSpacing
        });
    }
    if (intraElemMeas.left != 0) {
        $('#l-measure').show();
        $('#l-measure').width(Math.abs(intraElemMeas.left) - borderThickness);
        if (intraElemMeas.left > 0) {
            $('#l-measure').offset({
                top: elemSelectMeas.offsetTop + (elemSelectMeas.height / 2),
                left: elemSelectMeas.offsetLeft - intraElemMeas.left
            });
        } else {
            $('#l-measure').offset({
                top: elemSelectMeas.offsetTop + (elemSelectMeas.height / 2),
                left: elemSelectMeas.offsetLeft
            });
        }

        $('#l-dimension').show();
        $('#l-dimension > span').show();
        $('#l-dimension > span').text(Math.round(Math.abs(intraElemMeas.left)));
        $('#l-dimension').offset({
            top: elemSelectMeas.offsetTop + (elemSelectMeas.height / 2) - dimensionMarkerHeight - labelSpacing,
            left: elemSelectMeas.offsetLeft - (intraElemMeas.left / 2) - (dimensionMarkerWidth / 2)
        });
    }
}

//*************************************************************************************************
//*                                Update our redline spec panel.                                 *
//*************************************************************************************************
function updateRedlinePanel(element) {
    $.each(cssProperties, function(i, value) {
        $.each(cssProperties[i], function(_i, _value) {
            if (_i == '_content') {
                cssProperties[i][_i] = element.text().trim();
            } else {
                cssProperties[i][_i] = element.css(_i);
            }
        });
    });
    console.log(cssProperties);
    clearRedlinePanel();
    appendRedlinePanel();
    $('#redline-panel').addClass('redline-panel-exposed');
}

//*************************************************************************************************
//*                                Append each property section.                                  *
//*************************************************************************************************
function appendRedlinePanel() {
    $.each(cssProperties, function(i, value) {
        $('#redline-panel').append('<div class="redline-layer redline-panel-section"></div>');
        $('.redline-panel-section:last').append('<b class="redline-layer"><p class="redline-layer">' + i.toUpperCase() + '</p></b>');
        $.each(cssProperties[i], function(_i, _value) {
            if (_value != '' && _value != 'none' && _value != '0px') {
                $('.redline-panel-section:last').append('<p class="redline-layer">' + _i.replace('_', '').replace('-top-', '-').replace('-left-', '-') + ':</p>');
                if (_i != '_content') {
                    $('.redline-panel-section:last').append('<input class="redline-layer" value="' + _value + '" readonly="readonly"></input>');
                } else {
                    $('.redline-panel-section:last').append('<textarea class="redline-layer" readonly="readonly"></textarea>');
                    $('.redline-panel-section textarea').text(_value);
                }
            }
        });
        //*****Remove any sections without CSS properties.*****
        if ($('.redline-panel-section:last p').length <= 1) {
            $('.redline-panel-section:last').remove();
        }

    });
    //*****Remove a few items based on special queries.*****
    if (cssProperties['text']['_content'] == '') {
        $('p:contains("TEXT")').parent().parent().remove();
    }
    if (cssProperties['styles']['border-top-width'] == '0px') {
        $('p:contains("border-color")').next().remove();
        $('p:contains("border-color")').remove();
    }
}

//*************************************************************************************************
//*                       Strip all redline-specific elements from page.                          *
//*************************************************************************************************
function clearRedline() {
    $('.hover-layer').hide();
    $('.hover-o-layer').hide();
    $('.dimension-layer').hide();
    $('.measure-layer').hide();
}

//*************************************************************************************************
//*                              Handle 'click-aways' on page.                                    *
//*************************************************************************************************
function closeRedline() {
    clearRedline();
    $('.select-layer').hide();
    $('#redline-panel').removeClass('redline-panel-exposed');
    selectedElement = '';
    clearRedlinePanel();
}

//*************************************************************************************************
//*                           Clear all content in redline panel.                                 *
//*************************************************************************************************
function clearRedlinePanel() {
    $('#redline-panel > *').not('div:first').not('.redline-tool-enabler').remove();
}

//*************************************************************************************************
//*                             Find the deepest child element.                                   *
//*************************************************************************************************
function findDeepestChild(element) {
    var current = element;

    while (current.children().length > 1) {
        current = current.children();
    }

    return current;
}
</script>
